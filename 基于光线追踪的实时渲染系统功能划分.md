## 最小可行实现

### 场景表示

支持读取与存储基本场景几何, 包括: 
- 三角网格(OBJ/PLY), 需要能解析顶点、法线、UV, 并能够构建内部三角形列表
- 基础几何体: 球体与无限平面, 作为测试场景的最简形状. 
- 定义统一的 Geometry 接口: 能提供 AABB、射线相交测试、材质引用. 

场景中包含相机定义, 包括位置、朝向、焦距、FOV、成像平面大小等参数, 用于生成初始射线. 

### 基础路径追踪

实现渲染主循环: 对每个像素执行若干路径采样, 累积其光照贡献. 
从相机发射初始射线, 通过递归或循环方式执行路径追踪: 
1. 调用 BVH 结构判断当前射线与场景的最近相交. 
2. 如果命中物体, 则根据材质计算 BRDF 并随机采样新的方向继续追踪. 
3. 如果没命中, 则返回环境光. 
4. 使用蒙特卡洛积分估计像素值, 确保每条路径的贡献通过 PDF 正确归一化. 

路径长度使用 Russian Roulette 在能量低时概率终止, 以避免长路径浪费. 

### 简单材质

实现基础材质系统, 包括: 
- Lambert 漫反射: 使用余弦加权半球采样, 并保证 BRDF/PDF 定义正确. 
- 理想镜面反射: 根据反射方向生成新射线, 并保持能量守恒. 

材质需提供: 
- evaluate(): 给定入射/出射方向, 返回 BRDF 值. 
- sample(): 从该材质分布采样出射方向, 并返回方向、PDF 与 BRDF. 
- albedo 等基础参数. 

### BVH 加速结构

将所有三角形构建为层级包围盒(AABB), 减少射线相交次数. 
实现 BVH 构建过程(中点分割或按重心分桶), 构建后要能查询每个节点的 AABB 和子节点指针. 

实现射线遍历算法: 
1. 对节点 AABB 做相交测试, 不通过则剪枝. 
2. 通过则递归/栈式访问子节点, 最终找到最近三角形交点. 

### 多重采样与累积输出

对每个像素进行多次采样(随机/分层采样), 将所有样本累积到一个浮点颜色缓冲区. 

每一帧或所有采样完成后, 对颜色缓冲执行: 
- 色彩求平均
- Gamma 校正
- 考虑色彩裁剪与曝光

图像实时累积可用于增量预览, 让用户在采样多时逐渐看到收敛过程. 

### 硬件加速(CUDA 或 Vulkan RTX)

在 GPU 上实现路径追踪主循环, 提高大场景与高分辨率下的性能: 
- 把射线生成、BVH 遍历、材质采样拆分为 GPU kernel. 
- 使用并行 RNG, 每个像素/路径独立产生随机数. 

### 输出 PNG / EXR, 支持实时预览

输出 8-bit PNG 用于标准显示, 以及 16/32-bit 浮点 EXR 保存 HDR 结果. 
实现 GUI 或窗口实时显示渲染的累积结果(GLFW). 

## 进阶实现
### 多重重要性采样(MIS)

对光源和 BRDF 进行双重采样: 
- 光源采样: 随机选择光源、在光源表面采样点、生成从交点指向光源的方向. 
- BRDF 采样: 由材质随机决定出射方向. 

两者都能估计同一个路径贡献, 因此用 MIS 结合, 根据 balance heuristic 或 power heuristic 计算权重, 避免偏差. 

显著改善噪声, 特别在有区域光或尖锐高光时. 

### GGX 微表面模型

实现完整 Cook–Torrance 模型: 
- GGX 法向分布函数(NDF)
- Smith 几何遮挡项
- Fresnel-Schlick

支持金属与非金属材质(使用不同 F0)
增加重要性采样: 使用 GGX 分布采样半向量再计算出射方向, 提高收敛速度. 

### 景深

把相机改成“薄透镜”模型: 
- 设置光圈半径与焦平面距离. 
- 在镜头平面上随机采样一个点生成入射射线, 使景深范围外物体模糊. 

支持用户设置光圈大小以控制虚化强度. 

### HDRI 环境光

允许导入高动态范围环境贴图作为背景光源, 构建根据亮度分布的二维采样 PDF/CDF(通常按纬度方向加权). 从环境贴图中重要性采样方向, 减少高亮区域导致的噪点. 

可与 MIS 结合, 让环境采样与 BRDF 采样同时工作以更平滑. 

### 运动模糊

为物体、相机和变换添加时间维度参数(t0~t1). 每条路径生成时随机采样一个时间, 并使用该时间下的物体位置/姿态. 网格可以按顶点插值、实例变换插值或多 BVH 切片处理. 

使快速运动物体在单帧中呈现平滑拖影效果. 

### 体积光与雾

支持体积介质(均匀雾、烟、薄雾等), 在路径追踪中加入体积参与介质: 
- 实现吸收、散射、发射项, 使用指数采样估计散射点位置. 
- 使用 Henyey–Greenstein 相函数或 isotropic 采样散射方向. 

支持体积阴影(shadow ray 经过介质时衰减). 
用 delta-tracking(Woodcock)处理密度不均匀的体积. 